#include<stdio.h>
#include<stdlib.h>
#include<time.h>
#include<windows.h>
#include<conio.h>

int run(void);

void main(void){
	int field[9][23]={{0,0,0,0,1,1,0,3,0,3,0,3,0,3,0,3,0,1,1,0,0,0,0},//1-1
					  {0,0,0,0,1,1,0,3,0,3,0,3,0,3,0,3,0,1,1,0,0,0,0},//1-2
					  {0,0,0,0,1,1,0,3,0,3,0,3,0,3,0,3,0,1,1,0,0,0,0},//1-3
					  {0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0},//2-1
					  {0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0},//2-2
					  {0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0},//2-3
					  {0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0},//2-4
					  {0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0},//2-5
					  {0,0,0,0,1,1,0,0,0,0,0,5,0,0,0,0,0,1,1,0,0,0,0}};//3-1
	int i,j,k,c,za=5,sc=0;
	int n,m,r;
	char ziki;
	while(za>=0){
	n=0;
	m=0;

	
/////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////
//表示系
	for(i=0;i<9;i++){//表示
		for(j=0;j<23;j++){
			if(field[i][j]==0)
				printf(" ");
			else if(field[i][j]==1)//壁
				printf("|");
			else if(field[i][j]==2)//敵の攻撃
				printf("!");
			else if(field[i][j]==3)//敵
				printf("*");
			else if(field[i][j]==4)//弾
				printf("l");
			else if(field[i][j]==5)//自分
				printf("A");
		}
		printf("\n");
	}

	printf("スコア:%d\n 残 機:%d\n%d",sc,za,r);//スコア、残機表示

	for(i=0;i<9;i++){//初期化
		for(j=0;j<23;j++){
			if(field[i][j]==4)
				field[i][j]=0;
			else if(field[i][j]==2)
				field[i][j]=0;
			
		}
	}

/////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////
//操作系
	ziki = getch();
	for(j=6;j<17;j++){

		if(ziki == 0x61){//left
			if(field[8][j]==5){
				if(field[8][6]==5)
					break;
				field[8][j]=0;
				field[8][j-1]=5;
				break;
			}
		}

		else if(ziki == 0x64){//right
			if(field[8][j]==5){
				if(field[8][16]==5)
					break;
				field[8][j]=0;
				field[8][j+1]=5;
				break;
			}
		}

		else if(ziki == 0x6A){//弾発射
			if(field[8][j]==5){
			k=j;
			for(i=8;i>=0;i--){
				if(field[i][k]==0)
					field[i][k]=4;
				else if(field[i][k]==3){
					field[i][k]=0;
					break;
				}
			}
			break;
			}
		}

		else if(ziki==0x1B)//強制終了
			return;
	}

/////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////
//処理系
	sc=0;
	c=0;
	for(i=0;i<9;i++){//計算、判定、処理
		for(j=0;j<23;j++){
			if(field[i][j]==3)
				c++;
			sc=1500-100*c;
		}
	}

	if(sc==1500){
		system("cls");
		printf("Game Clear");
		Sleep(10000);
		return;
	}

	for(i=0;i<23;i++){
		if(field[0][i]==3){
			m=1;
			break;
		}
	}

		r=run();
	if(m==1){
		for(i=3;i<9;i++){

			field[i][r]=2;
}
	}


//////////////////////////////////////////////////////////////////////////////////
	for(i=0;i<23;i++){
		if(field[8][i]==5){
			n=1;
			break;
		}
	}

	if(n==0){
		za--;
		field[8][11]=5;
	}
		Sleep(100);
		system("cls");

	}

	system("cls");
	printf("Game Over");
	Sleep(10000);
	return;

}

int run(void){
	int r;
	srand((unsigned int)time(NULL));
	r=rand()%17+6;
	return r;
}

